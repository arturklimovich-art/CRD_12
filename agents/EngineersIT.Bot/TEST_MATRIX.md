# МАТРИЦА ПРИЕМОЧНЫХ ТЕСТОВ BOT V2

## T1: Простая задача (Complexity ≤30)
**Цель:** Проверка минимального рабочего цикла
- [ ] Submit-TZ → Complexity ≤30
- [ ] New-TZPlan → 1 задача (без декомпозиции)  
- [ ] Queue-EngineerJobs → 1 job создан
- [ ] Watch-Plan → статусы: CREATED → RUNNING → PASSED
- [ ] 0 ретраев, 0 уточнений

## T2: Средняя задача (Complexity 31-60) 
**Цель:** Проверка декомпозиции
- [ ] Submit-TZ → Complexity 31-60
- [ ] New-TZPlan → 2-4 подзадачи с parent_ids
- [ ] Queue-EngineerJobs → N jobs создано
- [ ] Проверка порядка выполнения по зависимостям
- [ ] Суммарный статус плана = COMPLETED

## T3: Сложная задача (Complexity ≥60)
**Цель:** Проверка строгой декомпозиции
- [ ] Submit-TZ → Complexity ≥60  
- [ ] New-TZPlan → 5+ этапов (контракты→каркас→тесты→интеграция→смоук)
- [ ] Проверка строгих зависимостей между этапами
- [ ] Имитация 1 FAILED → автоматический Refine-Task

## T4: Идемпотентность
**Цель:** Проверка дедупликации
- [ ] Двойная отправка identical задачи (одинаковый idempotency_key)
- [ ] Результат: 1 исполнение, 1 игнор дубликата
- [ ] В событиях: 1 TASK_QUEUED, 1 DUPLICATE_IGNORED

## T5: Health-гейты
**Цель:** Проверка реакций на недоступность
- [ ] Имитация /ready = false у Engineer_B
- [ ] Bot ставит планирование на паузу
- [ ] Нет плодящихся ошибок в очереди
- [ ] Соответствующие события HEALTH_DEGRADED

## T6: Таймауты и DLQ
**Цель:** Проверка обработки сбоев
- [ ] Имитация таймаута выполнения
- [ ] Статус FAILED + причина \"timeout\"
- [ ] Авто-refine с новым уточнением
- [ ] Уход в DLQ после N ретраев

## T7: Телеметрия и наблюдаемость
**Цель:** Проверка мониторинга
- [ ] Монитор показывает: поставлено/выполнено/в ретрае/DLQ
- [ ] Средние времена выполнения
- [ ] Текущий шаг DAG виден
- [ ] Корреляция по trace_id работает

## КРИТЕРИИ ПРИЕМКИ:
- ✅ Все тесты T1-T7 проходят
- ✅ Контракты соблюдаются
- ✅ Нет регрессий существующей функциональности
- ✅ Документация актуальна
