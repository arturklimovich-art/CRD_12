#!/bin/bash
set -e

echo "=== Starting CRD12 Bot Services ==="
echo "$(date) - Starting Telegram Bot and Task Manager"

# ??????? ?????????? ??? ?????
mkdir -p /var/log

# ?????? Telegram Bot ? ??????? ??????
echo "Starting Telegram Bot..."
nohup python3 -u /app/bot_integrated.py > /var/log/telegram_bot.log 2>&1 &
BOT_PID=$!
echo "Telegram Bot started with PID: $BOT_PID"

# ????????? ?????
sleep 2

# ?????? Task Manager ? ??????? ??????
echo "Starting Task Manager..."
nohup python3 -u -m tasks.task_manager > /var/log/task_manager.log 2>&1 &
TM_PID=$!
echo "Task Manager started with PID: $TM_PID"

# ????????? PID-?
echo $BOT_PID > /var/run/telegram_bot.pid
echo $TM_PID > /var/run/task_manager.pid

echo "=== Both services started successfully ==="
echo "Bot PID: $BOT_PID"
echo "Task Manager PID: $TM_PID"

# ?????????? ????? (?????? ????????? ????????)
tail -f /var/log/telegram_bot.log /var/log/task_manager.log
