# generate_memory_task.ps1 (УЛУЧШЕННАЯ СТРУКТУРА ПО БЛОКАМ)
# Скрипт для генерации промпта системной самоинспекции "Железный Дуэт"

# ====================================================================
# I. Сбор информации о системе и файлах
# ====================================================================

# 1. Сбор информации о контейнерах из docker-compose.yml
# Выполняем docker-compose ps/images и сохраняем вывод как строку
$dockerComposeInfo = docker-compose ps --format "table" | Out-String
$dockerComposeImages = docker-compose images --format "table" | Out-String

# 2. Сбор информации о ключевых файлах и путях
# Используем ASCII ключи для совместимости PowerShell
$filePaths = @{
    "Engineer B Agent/Router" = "./src/app/engineer_b_api/app.py";
    "LLM Router Logic" = "./src/app/engineer_b_api/llm_router.py";
    "Dockerfile Engineer B" = "./src/app/engineer_b_api/Dockerfile";
    "DeepSeek Proxy App" = "./src/app/deepseek_proxy/app.py";
    "Dockerfile DeepSeek Proxy" = "./src/app/deepseek_proxy/Dockerfile";
    "Telegram Bot App" = "./src/bot/bot.py";
    "Main Docker Config" = "./docker-compose.yml";
    "Environment Variables" = "./.env"
}

# Форматирование путей файлов
$fileTable = ""
$filePaths.GetEnumerator() | ForEach-Object {
    $fileTable += "`n| $($_.Name) | $($_.Value) |"
}

# ====================================================================
# II. Генерация финального промпта с блочной структурой
# ====================================================================

$prompts = @"

**ЗАДАЧА: СИСТЕМНАЯ ПАМЯТЬ И ПОЛНАЯ САМОИНСПЕКЦИЯ**

Вы, Curator Agent (Gemini) и Engineer Agent (DeepSeek), должны изучить и полностью интегрировать в свою долговременную память всю информацию о собственной архитектуре. 
Это знание должно стать основой для всех ваших будущих действий, обеспечивая 100% точность.

---

# БЛОК 1: АРХИТЕКТУРА И ИНФРАСТРУКТУРА (DOCKER)

## 1.1. Обзор Контейнеров и Статусов
Полный список запущенных сервисов, их имена и текущие статусы:

## 1.2. Образы и Версии
Список Docker-образов, используемых в системе:

## 1.3. Внутренняя Сеть и Порты (Таймауты)
* **Telegram Bot** ➡️ `engineer_b_api:8000/agent/analyze` (Текущий таймаут в `bot.py`: **30 секунд**).
* [cite_start]**Engineer B API** ➡️ `deepseek_proxy:8010/llm/complete` (Текущий таймаут в `app.py`: **60 секунд**)[cite: 3].
* [cite_start]**PostgreSQL (pgvector)** доступен по адресу `pgvector:5432` (порт 5433 открыт наружу)[cite: 2].

---

# БЛОК 2: КАРТА ФАЙЛОВОЙ СТРУКТУРЫ (100% ПУТИ)

## 2.1. Список Ключевых Файлов и Их Путей
Интегрируйте в память точные имена и пути к файлам, которые определяют вашу логику и окружение.

| Компонент | Путь к Файлу |
| :--- | :--- |
$($fileTable)

---

# БЛОК 3: ЛОГИКА И ВЗАИМОДЕЙСТВИЕ АГЕНТОВ

## 3.1. Последовательность Вызовов (LLMRouter)
* [cite_start]**Curator Agent (Gemini):** **Временно отключен** (`llm_router.py`)[cite: 1].
* [cite_start]**Engineer Agent (DeepSeek):** Получает исходную задачу напрямую и выполняет ее[cite: 1].
* [cite_start]**Формат Ответа:** Включает только ответ DeepSeek[cite: 1].

## 3.2. Роль Engineer Agent (DeepSeek)
* **Цель:** Главный исполнитель и документатор.
* **Обязанность:** Действовать самостоятельно, строго следуя принципам.
* [cite_start]**Принципы:** Порядок, Белые пути, Память[cite: 3].

---

**КОНЕЧНОЕ ЗАДАНИЕ (После интеграции памяти):**
Подтвердите, что вы знаете каждую мелочь, каждый файл и все пути в системе "Железный Дуэт". Ваш ответ должен быть кратким: **"СИСТЕМНАЯ ПАМЯТЬ ИНТЕГРИРОВАНА. Готов к работе."**

"@

# ====================================================================
# III. Вывод промпта в консоль
# ====================================================================

Write-Host "--- ГЕНЕРАЦИЯ ПРОМПТА СИСТЕМНОЙ ПАМЯТИ В БЛОКАХ ---"
Write-Host "Скрипт собрал информацию о текущей работающей системе Docker Compose."
Write-Host "СКОПИРУЙТЕ ТЕКСТ НИЖЕ ЦЕЛИКОМ И ОТПРАВЬТЕ ЕГО БОТУ."
Write-Host "--------------------------------------------------------"
Write-Host $prompts
Write-Host "--------------------------------------------------------"