# 📄 Спецификация реализации: E1-PATCH-MANUAL

**ID задачи в Roadmap**: E1-PATCH-MANUAL  
**Статус**: done  
**Дата завершения**: 11 ноября 2025  
**Цель**: Внедрить официальный, безопасный механизм ручного применения патчей через Navigator DB без изменения основного `app.py`.

## 🔧 Что реализовано

- Добавлена поддержка ручных патчей через таблицы `eng_it.patches` и `eng_it.patch_events`.
- Реализован внешний Python-скрипт `/app/workspace/patches/manual_apply_runtime.py` для применения патчей.
- Скрипт:
  - Подключается к Navigator DB (`crd12_pgvector`);
  - Проверяет статус `approved` и `approve_token`;
  - Пишет события `eng.apply_patch.*`;
  - Сохраняет патч в `/app/workspace/patches_applied/`.
- Полностью отделён от основного FastAPI-цикла — не ломает auto-deploy и self-healing.
- Поддерживается вызов из PowerShell через `docker exec`.

## 🧪 Верификация
- Патч с ID `f46262d1-ff1d-4612-909e-939b607b149a` успешно применён.
- События в `eng_it.patch_events` соответствуют формату системы.
- Файл патча сохранён в контейнере.

## 🔒 Безопасность
- Применение возможно только при `status = 'approved'` и наличии `approve_token`.
- Нет прямого влияния на `app.py` — основная логика не затронута.

## ⏭️ Дальнейшие улучшения (опционально)
- Вынос параметров БД в `.env`.
- Валидация путей/имён файлов.
- Интеграция с механизмом снапшотов.

> ✅ Задача полностью соответствует принципу: *Roadmap = Источник истины*.
