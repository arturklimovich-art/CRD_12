# ============================================================================
# ROADMAP/GENERAL_PLAN.yaml
# Core-каталог доменов системы CRD12
# Автор: arturklimovich-art
# Дата: 2025-11-23 16:47:14 UTC
# Версия: 2.0.0 (Федеративная модель SoT)
# ============================================================================

meta:
  system: "CRD12"
  version: 2.0
  description: "Федеративная система доменов с Source of Truth"
  updated_at: "2025-11-23T16:47:14Z"
  updated_by: "arturklimovich-art"
  changelog:
    - date: "2025-11-23"
      version: "2.0.0"
      changes:
        - "Добавлена федеративная модель доменов"
        - "Разделение на домены ENG и TL"
        - "Добавлена таблица sot_domains в БД"
        - "Создана структура ROADMAP/DOMAINS/"

# ============================================================================
# КАТАЛОГ ДОМЕНОВ
# ============================================================================
domains:
  - code: "ENG"
    title: "Engineers_IT"
    description: "Система автоматической разработки на основе LLM"
    owner: "arturklimovich-art"
    status: "active"
    version: "1.0.0"
    plan_path: "ROADMAP/DOMAINS/ENG/GENERAL_PLAN.yaml"
    api_base: "http://localhost:8001"
    repository: "https://github.com/arturklimovich-art/CRD12"
    documentation:
      passport: "ROADMAP/DOMAINS/ENG/PASSPORT.md"
      specs:
        - "SPEC/STRATEGY_ABI.md"
        - "SPEC/DATA_CONTRACT.md"
        - "SPEC/JOB_API.md"
    meta:
      technologies:
        - "Python 3.11"
        - "PostgreSQL 16 (pgvector)"
        - "FastAPI"
        - "Docker Compose"
        - "DeepSeek LLM"
      main_components:
        - "Bot (Telegram + PowerShell)"
        - "Engineer_B API (генерация кода)"
        - "Curator (проверка качества)"
        - "Navigator DB (статусы и история)"
      green_corridor:
        - "/app/agents/"
        - "/app/src/engineer_b_api/"
        - "/app/src/bot/"
        - "/app/workspace/patches/"
        - "/app/workspace/ADR/"
        - "/app/workspace/snapshots/"

  - code: "TL"
    title: "TradLab"
    description: "Система разработки и бэктестинга торговых стратегий"
    owner: "arturklimovich-art"
    status: "planned"
    version: "0.1.0-L1"
    plan_path: "ROADMAP/DOMAINS/TL/GENERAL_PLAN.yaml"
    api_base: "http://localhost:9091"
    repository: "https://github.com/arturklimovich-art/CRD12"
    documentation:
      passport: "ROADMAP/DOMAINS/TL/PASSPORT.md"
      specs:
        - "ROADMAP/DOMAINS/TL/specs/DataContract.md"
        - "ROADMAP/DOMAINS/TL/specs/StrategyABI.md"
        - "ROADMAP/DOMAINS/TL/specs/ReportContract.md"
        - "ROADMAP/DOMAINS/TL/specs/STR-100_ChainFlowAlpha_v3_2.md"
    meta:
      technologies:
        - "Python 3.11"
        - "PostgreSQL 16 (схемы: market, lab)"
        - "FastAPI"
        - "pandas / numpy"
        - "Binance API (demo testnet)"
      main_components:
        - "Collector (OHLCV ingestion)"
        - "Strategy Engine (STR-100 ChainFlow)"
        - "Backtester v1"
        - "Risk-Gate v1 (MinTRL, PSR, DSR, PBO)"
        - "Demo-Executor v1"
        - "Orchestrator CLI"
      green_corridor:
        - "/app/src/tradlab/"
        - "/app/workspace/reports/TL/"
        - "/app/workspace/specs/"
        - "/app/workspace/patches/DB/"
      current_stage: "L1"
      blocks:
        - "B0: Модуль Истины (SoT)"
        - "B1: Управление качеством и контракты"
        - "B2: Данные и БД"
        - "B3: Strategy-ABI и STR-100"
        - "B4: Бэктест и метрики"
        - "B5: Risk-Gate v1"
        - "B6: Оркестратор v1"
        - "B7: Наблюдаемость v1"
        - "B8: Demo-Executor v1"

# ============================================================================
# ПОЛИТИКИ СИСТЕМЫ
# ============================================================================
policies:
  # Синхронизация
  sync:
    yaml_to_db_on_startup: true
    db_to_yaml_on_snapshot: true
    auto_sync_interval_minutes: 30
    conflict_resolution: "manual"  # manual | auto_db_wins | auto_yaml_wins

  # Качество и проверки
  quality:
    curator_required_for_done: true
    min_test_coverage_percent: 70
    smoke_tests_required: true
    snapshot_on_done: true

  # Версионирование
  versioning:
    git_commit_on_artifact: true
    git_tag_on_milestone: true
    backup_before_migration: true

  # Безопасность
  security:
    green_corridor_enforcement: true
    require_approval_for_production: true
    audit_all_changes: true

  # Наблюдаемость
  observability:
    log_level: "INFO"  # DEBUG | INFO | WARNING | ERROR
    metrics_enabled: true
    grafana_dashboards: true
    snapshot_retention_days: 90

# ============================================================================
# ИНТЕГРАЦИИ МЕЖДУ ДОМЕНАМИ
# ============================================================================
integrations:
  - source: "ENG"
    target: "TL"
    type: "code_generation"
    description: "Engineers_IT генерирует код для TradLab по ТЗ"
    enabled: true
    meta:
      generation_mode: "pull_request"  # direct | pull_request
      curator_approval: true

  - source: "TL"
    target: "ENG"
    type: "feedback"
    description: "TradLab отправляет метрики и логи для анализа Engineers_IT"
    enabled: false  # Пока не реализовано
    meta:
      feedback_topics:
        - "strategy_performance"
        - "backtest_results"
        - "error_logs"

# ============================================================================
# ГЛОБАЛЬНЫЕ НАСТРОЙКИ
# ============================================================================
global:
  database:
    dsn: "postgresql://crd_user:***@localhost:5433/crd12"
    schema_eng: "eng_it"
    schema_market: "market"
    schema_lab: "lab"

  repositories:
    main: "https://github.com/arturklimovich-art/CRD12"
    branches:
      production: "main"
      development: "develop"
      feature_prefix: "feature/"

  namespaces:
    events:
      - "ps.patch.*"
      - "eng.apply_patch.*"
      - "plan.*"
      - "navigator.*"
      - "roadmap.*"
      - "bot.*"
      - "llm.*"
      - "curator.*"
      - "audit.system.*"
      - "tradlab.*"

  contacts:
    owner: "arturklimovich-art"
    repository_issues: "https://github.com/arturklimovich-art/CRD12/issues"

# ============================================================================
# ИСТОРИЯ ИЗМЕНЕНИЙ CORE-КАНОНА
# ============================================================================
history:
  - date: "2025-11-23T16:47:14Z"
    version: "2.0.0"
    author: "arturklimovich-art"
    task: "E1-B0-T2-S2"
    changes:
      - "Создана федеративная модель доменов"
      - "Зарегистрированы домены ENG и TL"
      - "Добавлены политики синхронизации"
      - "Определены интеграции между доменами"
    files_modified:
      - "ROADMAP/GENERAL_PLAN.yaml"
      - "DB/migrations/20251123_001_sot_foundation.sql"
    db_changes:
      - "eng_it.sot_domains (INSERT ENG, TL)"
      - "eng_it.roadmap_blocks (+domain_code)"
      - "eng_it.roadmap_tasks (+domain_code)"

  - date: "2025-11-05T10:19:57Z"
    version: "1.0.0"
    author: "arturklimovich-art"
    changes:
      - "Первоначальная версия GENERAL_PLAN.yaml"
      - "Определены блоки E1-L1 ... E1-L8"
    files_modified:
      - "ROADMAP/GENERAL_PLAN.yaml"
